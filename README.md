# ğŸ”º Prism - Enterprise AI Governance Hub

> **Intelligent Gateway for Secure, Cost-Optimized, and RAG-Enhanced LLM Orchestration.**

![License](https://img.shields.io/badge/license-MIT-blue)
![Version](https://img.shields.io/badge/version-1.1.0-green)
![Status](https://img.shields.io/badge/status-Production_Ready-success)

**Prism (ãƒ—ãƒªã‚ºãƒ )** ã¯ã€ä¼æ¥­åˆ©ç”¨ã‚’æƒ³å®šã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ã‚¹ãƒˆç®¡ç†ã‚’ä¸¡ç«‹ã•ã›ãŸæ¬¡ä¸–ä»£ã® AI ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨LLMã®é–“ã«ã€Œã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ»ã‚«ãƒ¼ãƒãƒ«ã€ã‚’é…ç½®ã™ã‚‹ã“ã¨ã§ã€å®‰å…¨ã«ç¤¾å†…æƒ…å ±ï¼ˆRAGï¼‰ã‚’æ´»ç”¨ã—ã€æ¥­å‹™ç‰¹åŒ–å‹ã®æ¨è«–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

## ğŸš€ Key Features (ä¸»ãªæ©Ÿèƒ½)

### 1. ğŸ” Multi-User & Secure Login [NEW]
**è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹åŒæ™‚ãƒ­ã‚°ã‚¤ãƒ³ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢ã«å¯¾å¿œã—ã¾ã—ãŸã€‚**
- **å€‹åˆ¥èªè¨¼:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®IDç®¡ç†ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿç¾ã€‚
- **å±¥æ­´ã®åˆ†é›¢:** ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚„ç›£æŸ»ãƒ­ã‚°ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆ`user_id`ï¼‰ã«ç´ã¥ã„ã¦ç®¡ç†ã•ã‚Œã€ä»–è€…ã®ãƒ‡ãƒ¼ã‚¿ã¨æ··åœ¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®åˆ©ç”¨çŠ¶æ³ã«å¿œã˜ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¶­æŒãŒå¯èƒ½ã€‚
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ (Mock):** ãƒ†ãƒŠãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ã¨çŸ¥è­˜ï¼ˆRAGï¼‰ã‚’è«–ç†çš„ã«å®Œå…¨åˆ†é›¢ã€‚

### 2. ğŸ›¡ï¸ Governance & Dynamic Routing
å…¥åŠ›å†…å®¹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è§£æã—ã€æœ€é©ãªã€Œãƒ¢ãƒ¼ãƒ‰ã€ã¸è‡ªå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚
- **FLASH Mode:** ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚„æ ªä¾¡ãªã©ã®é€Ÿå ±ï¼ˆWebæ¤œç´¢åˆ©ç”¨ï¼‰ã€‚
- **HEAVY Mode:** å¥‘ç´„æ›¸ã‚„åŒ»ç™‚æƒ…å ±ã®ç²¾å¯†åˆ†æï¼ˆPIIæ¤œçŸ¥ãƒ»é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ï¼‰ã€‚
- **PII Shield:** æ©Ÿå¯†æƒ…å ±ï¼ˆå€‹äººæƒ…å ±ãªã©ï¼‰ã‚’æ¤œçŸ¥ã—ã€å¤–éƒ¨æµå‡ºã‚’æœªç„¶ã«é˜²ããƒã‚¹ã‚­ãƒ³ã‚°æ©Ÿèƒ½ã€‚

### 3. ğŸ§  Hybrid RAG (Retrieval-Augmented Generation)
**ChromaDB (ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢)** ã¨ **SQLite (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢)** ã‚’çµ„ã¿åˆã‚ã›ãŸãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ­è¼‰ã€‚
- **ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹:** ç¤¾å†…è¦å®šã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’ç™»éŒ²ã—ã€AIã«ã€Œé•·æœŸè¨˜æ†¶ã€ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚
- **é«˜ç²¾åº¦ãªæ¤œç´¢:** ã€Œæ¦‚å¿µï¼ˆã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆï¼‰ã€ã¨ã€Œå“ç•ªï¼ˆPROJ-A77ï¼‰ã€ã®ä¸¡æ–¹ã‚’æ­£ç¢ºã«æ¤œç´¢ã—ã€ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå˜˜ï¼‰ã‚’æŠ‘åˆ¶ã€‚

### 4. ğŸ“Š Multi-modal Analysis
è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPDF, CSV, Excelï¼‰ã‚’åŒæ™‚ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€LLM ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«çµ±åˆã€‚
- **æ¯”è¼ƒåˆ†æ:** è¤‡æ•°ã®æ±ºç®—æ›¸PDFã‚’èª­ã¿è¾¼ã¿ã€å·®ç•°ã‚„æ•°å€¤ã‚’æ¯”è¼ƒã—ã¦Markdownã®è¡¨å½¢å¼ã§å‡ºåŠ›ã€‚

### 5. âœ¨ Real-time UX & Audit
- **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­” (NDJSON):** AIã®å›ç­”ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”»é¢ã«é€æ¬¡è¡¨ç¤ºã—ã€å¿œç­”å¾…ã¡ã®ã‚¹ãƒˆãƒ¬ã‚¹ã‚’è§£æ¶ˆã€‚
- **ç›£æŸ»ãƒ­ã‚°:** å…¨ã¦ã®ä¼šè©±ã€ä½¿ã‚ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã€æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²ã€‚ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ãƒ­ã‚°ã‚’å¾©å…ƒã—ã€åˆ©ç”¨çŠ¶æ³ã‚’ç›£æŸ»å¯èƒ½ã€‚

---

## ğŸ›  Architecture

Frontend (Angular) ã¨ Backend (FastAPI) ã«ã‚ˆã‚‹ãƒ¢ãƒ€ãƒ³ãªç–çµåˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
èªè¨¼ã«ã¯ HttpOnly Cookie ã‚’æ¡ç”¨ã—ã€XSSå¯¾ç­–ã‚’å¼·åŒ–ã—ã¦ã„ã¾ã™ã€‚

```mermaid
graph TD
    User["User / Browser"] -->|"HTTPS / Cookie Auth"| FE["Angular Frontend (Prism UI)"]
    FE -->|"REST API / Session Cookie"| BE["FastAPI Backend"]
    
    subgraph "Governance Kernel (Backend)"
        BE --> Auth["Auth Manager (Multi-tenant)"]
        BE --> Router["Mode Router"]
        BE --> PII["PII Shield"]
        Router -->|"Routing"| Model["LLM Orchestrator"]
        
        subgraph "Hybrid RAG Engine"
            BE --> Vector["Vector Store (ChromaDB)"]
            BE --> Keyword["Keyword Store (SQLite)"]
        end
    end
    
    Model -->|"API Call"| Google["Google Gemini 2.5 Pro/Flash"]
    BE -->|"User Log & Audit"| DB[("SQLite / Audit DB")]
````

### Tech Stack

  * **Frontend:** Angular 20+, Angular Material (Enterprise UI), Signals, ngx-markdown
  * **Backend:** Python 3.11+, FastAPI (ASGI/Async), SQLModel
  * **Auth:** Mock Auth (Development) / Ready for OIDC (Production), HttpOnly Cookie
  * **AI Engine:** Google Gemini 2.5 Pro / Flash (Dynamic Model Routing)
  * **Data:** **ChromaDB** (Vector Search), **SQLite** (Audit Logs & Keyword Search)

-----

## ğŸ¤ Contribution & Contact (åˆ©ç”¨ä¸Šã®æ³¨æ„)

**âš ï¸ IMPORTANT: ã”åˆ©ç”¨ã®å‰ã«**

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ç­†è€…ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãŠã‚ˆã³æŠ€è¡“æ¤œè¨¼ç”¨ã¨ã—ã¦ã€AIé§†å‹•é–‹ç™ºï¼ˆAI-Driven Developmentï¼‰ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚

**æœ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ã‚¯ã€ã¾ãŸã¯å•†ç”¨åˆ©ç”¨ãƒ»å¤§è¦æ¨¡å±•é–‹ã®ãŸã‚ã«ã”æ´»ç”¨ã•ã‚Œã‚‹å ´åˆã¯ã€å¿…ãšäº‹å‰ã«ç­†è€…ã¾ã§ã”é€£çµ¡ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚**
ï¼ˆå­¦ç¿’ç”¨ãƒ»å€‹äººåˆ©ç”¨ã®ç¯„å›²ã§ã‚ã‚Œã°ã”è‡ªç”±ã«å‚ç…§ãã ã•ã„ï¼‰

ã“ã‚Œã¯ã€ç­†è€…ãŒã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è²¢çŒ®è€…ã¨ã—ã¦ã€ã¾ãŸä»Šå¾Œã®é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®ãŠé¡˜ã„ã§ã™ã€‚

| é …ç›® | è©³ç´° |
| :--- | :--- |
| **é€£çµ¡å…ˆ** | GitHub Issue ã¾ãŸã¯ kanade.yumesaki.mail@gmail.com |
| **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹** | MIT (å•†ç”¨åˆ©ç”¨å¯èƒ½ã§ã™ãŒã€ä¸Šè¨˜é€£çµ¡ã‚’ãŠé¡˜ã„ã—ã¾ã™) |

-----

## ğŸ“¦ Installation & Quick Start

### 1\. Default Login Credentials (åˆæœŸãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±)

æœ¬ãƒãƒ¼ã‚¸ãƒ§ãƒ³(v1.1.0)ã§ã¯ã€é–‹ç™ºç”¨ã¨ã—ã¦ä»¥ä¸‹ã® **Mockã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** ãŒåˆæœŸè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ã¯ä»¥ä¸‹ã®çµ„ã¿åˆã‚ã›ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

| Role | Tenant ID | User ID | æ¨©é™ |
| :--- | :--- | :--- | :--- |
| **Admin** | `tenant-a` | `user-1` | **ç®¡ç†è€…** (å…¨ãƒ­ã‚°é–²è¦§å¯) |
| User | `tenant-a` | `user-2` | ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ (è‡ªåˆ†ã®ãƒ­ã‚°ã®ã¿) |
| User | `tenant-b` | `user-1` | åˆ¥ãƒ†ãƒŠãƒ³ãƒˆã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ |

> [\!WARNING]
> **Production Security Alert (å•†ç”¨åˆ©ç”¨æ™‚ã®æ³¨æ„)**
>
> ä¸Šè¨˜ã® `Mock Auth` ãŠã‚ˆã³åˆæœŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€**é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆå°‚ç”¨**ã§ã™ã€‚
> æœ¬ç•ªç’°å¢ƒï¼ˆProductionï¼‰ã§é‹ç”¨ã™ã‚‹éš›ã¯ã€å¿…ãšä»¥ä¸‹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚
>
> 1.  **Switch to Real IdP:** `backend/auth.py` ã®ãƒ¢ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ã—ã€**Azure AD (Entra ID)**, **Auth0**, **Google Workspace** ç­‰ã® OIDC/SAML èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«æ¥ç¶šã™ã‚‹å®Ÿè£…ã¸å·®ã—æ›¿ãˆã¦ãã ã•ã„ã€‚
> 2.  **Disable Mock Login:** `/auth/mock-login` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‰Šé™¤ã¾ãŸã¯ç„¡åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚
> 3.  **Rotate Keys:** `.env` å†…ã® `SECRET_KEY` ã¯ã€æ¨æ¸¬ä¸å¯èƒ½ãªé•·ãè¤‡é›‘ãªæ–‡å­—åˆ—ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

-----

### 2\. Docker Launch (æ¨å¥¨)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
# 1. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
cp .env.example .env
# .env ã‚’ç·¨é›†ã—ã€GEMINI_API_KEY ã‚’è¨­å®šã—ã¦ãã ã•ã„

# 2. èµ·å‹•
docker-compose up -d --build
```

Access: `http://localhost`

### 3\. Manual Launch (é–‹ç™ºç”¨)

**Backend:**

```bash
cd backend
python -m venv .venv
source .venv/bin/activate  # Windows: .\.venv\Scripts\Activate
pip install -r requirements.txt
uvicorn main:app --reload --port 8000
```

**Frontend:**

```bash
cd frontend
npm install
ng serve
```

Access: `http://localhost:4200`

-----

## âš™ï¸ Configuration (Policies)

`backend/policies.yaml` ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ã§ã€ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ«ãƒ¼ãƒ«ã‚’ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã§èª¿æ•´å¯èƒ½ã§ã™ã€‚

```yaml
modes:
  - id: "HEAVY"
    safety_level: "high"
    allow_web_search: false # ç¤¾å†…ç§˜æƒ…å ±ã®æµå‡ºé˜²æ­¢
    triggers:
      keywords_any: ["å¥‘ç´„", "æ³•å‹™", "PII"]
```

-----

## ğŸ“ License

[MIT](https://www.google.com/search?q=LICENSE)

